{
  "id": "admission-default-machine",
  "canonicalName": "admission-machine",
  "initials": ["U:admission-default-universe"],
  "description": "Define all flows of an admission",
  "version": "0.1.0",

  "universes": {
    "admission-default-universe": {
      "id": "admission-default-universe",
      "canonicalName": "admission",
      "initial": "CREATED",
      "description": "Define the flow of an admission",
      "version": "0.1.0",
      "realities": {
        "CREATED": {
          "id": "CREATED",
          "type": "transition",
          "description": "Admission created, means that a place was reserved for the user",
          "always": [
            {
              "targets": [
                "U:admission-default-waiting-confirmation-universe:WAITING-CONFIRMATION"
              ]
            }
          ]
        },
        "CANCELLED": {
          "id": "CANCELLED",
          "type": "unsuccessfulFinal",
          "description": "Admission cancelled by the user or by the campus",
          "observers":[
            {
              "src": "builtin:observer:alwaysTrue"
            }
          ]
        }
      }
    },

    "admission-default-waiting-confirmation-universe": {
      "id": "admission-default-waiting-confirmation-universe",
      "canonicalName": "admission-waiting-confirmation",
      "initial": "WAITING-CONFIRMATION",
      "description": "Define the flow of a waiting confirmation",
      "version": "0.1.0",
      "realities": {
        "WAITING-CONFIRMATION": {
          "id": "WAITING-CONFIRMATION",
          "type": "transition",
          "description": "Admission is waiting for user confirmation",
          "on": {
            "confirmed": [
              {
                "targets": ["CONFIRMED"],
                "description": "User confirmed the admission"
              }
            ]
          }
        },
        "CONFIRMED": {
          "id": "CONFIRMED",
          "type": "final",
          "description": "Admission was confirmed by the user",
          "always": [
            {
              "targets": [
                "U:admission-default-payment-universe",
                "U:admission-default-form-universe",
                "U:admission-default-sign-universe"
              ],
              "type": "notify"
            }
          ]
        },
        "REJECTED": {
          "id": "REJECTED",
          "type": "unsuccessfulFinal",
          "description": "Admission rejected by the user on the confirmation step",
          "always": [
            {
              "targets": [
                "U:admission-default-universe:CANCELLED"
              ],
              "type": "notify"
            }
          ]
        }
      }
    },

    "admission-default-payment-universe": {
      "id": "admission-default-payment-universe",
      "canonicalName": "admission-payment",
      "initial": "WAITING-PAYMENT",
      "description": "Define the flow of an admission payment",
      "version": "0.1.0",
      "realities": {
        "WAITING-PAYMENT": {
          "id": "WAITING-PAYMENT",
          "type": "transition",
          "description": "Admission payment is waiting for payment",
          "on": {
            "paid": [
              {
                "targets": ["PAID"],
                "description": "User paid the admission"
              }
            ]
          }
        },
        "PAID": {
          "id": "PAID",
          "type": "final",
          "description": "Admission payment was paid",
          "always": [
            {
              "targets": ["U:admission-default-enrollment-completed:COMPLETED"],
              "description": "Transition to COMPLETED when the payment is paid",
              "type": "notify"
            }
          ]
        }
      }
    },

    "admission-default-form-universe": {
      "id": "admission-default-form-universe",
      "canonicalName": "admission-form",
      "initial": "FILLING-ENROLLMENT-FORM",
      "description": "Define the flow of an admission enrollment form",
      "version": "0.1.0",
      "realities": {
        "FILLING-ENROLLMENT-FORM": {
          "id": "FILLING-ENROLLMENT-FORM",
          "type": "transition",
          "description": "Admission enrollment form is being filled",
          "on": {
            "filled-form": [
              {
                "targets": ["ENROLLMENT-FORM-FILLED"],
                "description": "User filled the admission enrollment form"
              }
            ]
          }
        },
        "ENROLLMENT-FORM-FILLED": {
          "id": "ENROLLMENT-FORM-FILLED",
          "type": "final",
          "description": "Admission enrollment form was completed",
          "always": [
            {
              "targets": ["U:admission-default-enrollment-completed:COMPLETED"],
              "description": "Transition to COMPLETED when the enrollment form is filled",
              "type": "notify"
            }
          ]
        }
      }
    },

    "admission-default-sign-universe": {
      "id": "admission-default-sign-universe",
      "canonicalName": "admission-sign",
      "initial": "WAITING-SIGNATURE",
      "description": "Define the flow of an admission contract sign",
      "version": "0.1.0",
      "realities": {
        "WAITING-SIGNATURE": {
          "id": "WAITING-SIGNATURE",
          "type": "transition",
          "description": "Admission contract sign is waiting for sign",
          "on": {
            "signed": [
              {
                "targets": ["CONTRACT-SIGNED"],
                "description": "User signed the admission contract sign"
              }
            ]
          }
        },
        "CONTRACT-SIGNED": {
          "id": "CONTRACT-SIGNED",
          "type": "final",
          "description": "Admission contract sign was signed",
          "always": [
            {
              "targets": ["U:admission-default-enrollment-completed:COMPLETED"],
              "description": "Transition to COMPLETED when the contract is signed",
              "type": "notify"
            }
          ]
        }
      }
    },

    "admission-default-completed": {
      "id": "admission-default-enrollment-completed",
      "canonicalName": "admission-enrollment-completed",
      "description": "Define the flow of an admission completed",
      "version": "0.1.0",
      "realities":{
        "COMPLETED": {
          "id": "COMPLETED",
          "type": "final",
          "description": "Admission completed",
          "observers": [
            {
              "src": "builtin:observer:containsAllEvents",
              "args":{
                "1": "paid",
                "2": "filled-form",
                "3": "signed"
              }
            }
          ]
        }
      }
    }
  },

  "universalConstants": {
    "entryInvokes": [
      {
        "src": "notifyStatusChanged"
      }
    ],
    "entryActions": [
      {
        "src": "logEntryToStatus"
      }
    ],
    "exitActions": [
      {
        "src": "builtin:action:logBasicInfo"
      }
    ],

    "actionsOnTransition": [
      {
        "src": "builtin:action:logBasicInfo"
      }
    ]
  }
}
