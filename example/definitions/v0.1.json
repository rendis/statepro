{
  "id": "admission_default_machine",
  "canonicalName": "admission_machine",
  "initials": ["U:admission_default_universe"],
  "description": "Define all flows of an admission",
  "version": "0.1.0",

  "universes": {
    "admission_default_universe": {
      "id": "admission_default_universe",
      "canonicalName": "admission",
      "initial": "CREATED",
      "description": "Define the flow of an admission",
      "version": "0.1.0",
      "realities": {
        "CREATED": {
          "id": "CREATED",
          "type": "transition",
          "description": "Admission created, means that a place was reserved for the user",
          "always": [
            {
              "targets": [
                "U:admission_default_waiting_confirmation_universe:WAITING_CONFIRMATION"
              ]
            }
          ]
        },
        "CANCELLED": {
          "id": "CANCELLED",
          "type": "unsuccessfulFinal",
          "description": "Admission cancelled by the user or by the campus",
          "observers":[
            {
              "src": "builtin:observer:alwaysTrue"
            }
          ]
        }
      }
    },

    "admission_default_waiting_confirmation_universe": {
      "id": "admission_default_waiting_confirmation_universe",
      "canonicalName": "admission_waiting_confirmation",
      "initial": "WAITING_CONFIRMATION",
      "description": "Define the flow of a waiting confirmation",
      "version": "0.1.0",
      "realities": {
        "WAITING_CONFIRMATION": {
          "id": "WAITING_CONFIRMATION",
          "type": "transition",
          "description": "Admission is waiting for user confirmation",
          "on": {
            "confirmed": [
              {
                "targets": ["CONFIRMED"],
                "description": "User confirmed the admission"
              }
            ]
          }
        },
        "CONFIRMED": {
          "id": "CONFIRMED",
          "type": "final",
          "description": "Admission was confirmed by the user",
          "always": [
            {
              "targets": [
                "U:admission_default_payment_universe",
                "U:admission_default_form_universe",
                "U:admission_default_sign_universe"
              ],
              "type": "notify"
            }
          ]
        },
        "REJECTED": {
          "id": "REJECTED",
          "type": "unsuccessfulFinal",
          "description": "Admission rejected by the user on the confirmation step",
          "always": [
            {
              "targets": [
                "U:admission_default_universe:CANCELLED"
              ],
              "type": "notify"
            }
          ]
        }
      }
    },

    "admission_default_payment_universe": {
      "id": "admission_default_payment_universe",
      "canonicalName": "admission_payment",
      "initial": "WAITING_PAYMENT",
      "description": "Define the flow of an admission payment",
      "version": "0.1.0",
      "realities": {
        "WAITING_PAYMENT": {
          "id": "WAITING_PAYMENT",
          "type": "transition",
          "description": "Admission payment is waiting for payment",
          "on": {
            "paid": [
              {
                "targets": ["PAID"],
                "description": "User paid the admission"
              }
            ]
          }
        },
        "PAID": {
          "id": "PAID",
          "type": "final",
          "description": "Admission payment was paid",
          "always": [
            {
              "targets": ["U:admission_default_completed:COMPLETED"],
              "description": "Transition to COMPLETED when the payment is paid",
              "type": "notify"
            }
          ]
        }
      }
    },

    "admission_default_form_universe": {
      "id": "admission_default_form_universe",
      "canonicalName": "admission_form",
      "initial": "FILLING_ENROLLMENT_FORM",
      "description": "Define the flow of an admission enrollment form",
      "version": "0.1.0",
      "realities": {
        "FILLING_ENROLLMENT_FORM": {
          "id": "FILLING_ENROLLMENT_FORM",
          "type": "transition",
          "description": "Admission enrollment form is being filled",
          "on": {
            "filled_form": [
              {
                "targets": ["ENROLLMENT_FORM_FILLED"],
                "description": "User filled the admission enrollment form"
              }
            ]
          }
        },
        "ENROLLMENT_FORM_FILLED": {
          "id": "ENROLLMENT_FORM_FILLED",
          "type": "final",
          "description": "Admission enrollment form was completed",
          "always": [
            {
              "targets": ["U:admission_default_completed:COMPLETED"],
              "description": "Transition to COMPLETED when the enrollment form is filled",
              "type": "notify"
            }
          ]
        }
      }
    },

    "admission_default_sign_universe": {
      "id": "admission_default_sign_universe",
      "canonicalName": "admission_sign",
      "initial": "WAITING_SIGNATURE",
      "description": "Define the flow of an admission contract sign",
      "version": "0.1.0",
      "realities": {
        "WAITING_SIGNATURE": {
          "id": "WAITING_SIGNATURE",
          "type": "transition",
          "description": "Admission contract sign is waiting for sign",
          "on": {
            "signed": [
              {
                "targets": ["CONTRACT_SIGNED"],
                "description": "User signed the admission contract sign"
              }
            ]
          }
        },
        "CONTRACT_SIGNED": {
          "id": "CONTRACT_SIGNED",
          "type": "final",
          "description": "Admission contract sign was signed",
          "always": [
            {
              "targets": ["U:admission_default_completed:COMPLETED"],
              "description": "Transition to COMPLETED when the contract is signed",
              "type": "notify"
            }
          ]
        }
      }
    },

    "admission_default_completed": {
      "id": "admission_default_completed",
      "canonicalName": "admission_completed",
      "initial": "COMPLETED",
      "description": "Define the flow of an admission completed",
      "version": "0.1.0",
      "realities":{
        "COMPLETED": {
          "id": "COMPLETED",
          "type": "final",
          "description": "Admission completed",
          "observers": [
            {
              "src": "builtin:observer:containsAllEvents",
              "args":{
                "1": "paid",
                "2": "filled_form",
                "3": "signed"
              }
            }
          ]
        }
      }
    }
  },

  "universalConstants": {
    "entryInvokes": [
      {
        "src": "notifyStatusChanged"
      }
    ],
    "entryActions": [
      {
        "src": "logEntryToStatus"
      }
    ],
    "exitActions": [
      {
        "src": "builtin:action:logBasicInfo"
      }
    ],

    "actionsOnTransition": [
      {
        "src": "builtin:action:logBasicInfo"
      }
    ]
  }
}
